<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>The Fall of the House of Vulkan</title>

    <link rel="icon" type="image/x-icon" href="../favicon.ico">

    <!-- fonts-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">

    <!-- code highlighting stuff -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/styles/ir-black.min.css" integrity="sha512-koyJNDRWiSkXWV9VpMDJXZnwgO5wB1VsSw5O7XpkYFBL9Yjp6QiotG1CPuD3iHbOw5a3obVP5guUzxhJA0Dmhw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/highlight.min.js" integrity="sha512-6yoqbrcLAHDWAdQmiRlHG4+m0g/CT/V9AGyxabG8j7Jk8j3r3K6due7oqpiRMZqcYe9WM2gPcaNNxnl2ux+3tA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.10.0/languages/c.min.js" integrity="sha512-Ny9z3+WJkmC2xW098BNYhPajzsf8iBika/+58Mh4lHCF/it92UR32xhytP4I/yxKmF1fkcEgIF87qbGyz1nmDQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>hljs.highlightAll();</script>
    
    <!-- custom styles -->
    <link rel="stylesheet" href="../css/fonts.css">
    <link rel="stylesheet" href="../css/blog.css">
</head>
<body class="max-width-1000 centered">
    <h1 class="title merriweather-black">The Fall of the House of Vulkan</h1>

    <h2 id="prologue" class="chapter merriweather-black">Prologue</h2>
    <article class="merriweather-regular">
    <p>
        <i>
            During the whole of a dull, dark, and soundless day in the autumn of the year, when the clouds hung oppressively low in the heavens,
            I had been programming alone, on a laptop, a singularly dreary project; and at length found myself, as the shades of the evening
            drew on, within view of the interpolated triangle. I know not how it was, but, with the first glimpse of the API,
            a sense of insufferable doom pervaded my spirit.
        </i>
    </p>
    <p>
        Take a look at this image:
    </p>
    <p>
        <a href="https://en.wikipedia.org/wiki/Utah_teapot#/media/File:Utah_teapot_simple_2.png" target="_blank"><img alt="3D render of the Utah teapot" src="https://upload.wikimedia.org/wikipedia/commons/5/5f/Utah_teapot_simple_2.png"></a>
    </p>
    <p>
        What is it?
    </p>
    <p>
        Well, it's a teapot.
    </p>
    <p>
        Is it <em>real</em>?
    </p>
    <p>
        Of course not.
    </p>
    <p>
        This teapot was <em>inspired</em> by a <a href="https://en.wikipedia.org/wiki/Utah_teapot#/media/File:Original_Utah_Teapot.jpg" target="_blank">real teapot</a>,
        but, alas, the image above is <em>not</em> the image of a real teapot.
        It's an imitation, an artificial reproduction, a simulacrum, and a convincing one at that.
    </p>
    <p>
        Does it matter that it is <em>not</em> real? What is the difference between the real and the fake?
    </p>
    <p>
        I'm not here to discuss <a href="https://a.co/d/5n0AdIY" target="_blank">philosophy</a>.
    </p>
    <p>
        No, I'm here to tell you something more important:
    </p>
    <p class="centered-text big bold">
        You have been scammed.
    </p>
    <p>
        A trillion-dollar industry has convinced you that you need to pay <a href="https://www.amazon.com/s?k=rtx+4090" target="_blank">thousands of dollars</a> to create your own simulacra.
    </p>
    <p>
        And that you also need to write a <a href="https://github.com/SaschaWillems/Vulkan/blob/master/examples/triangle/triangle.cpp" target="_blank">thousand lines</a> of code just to display a single triangle.
    </p>
    <p>
        I am here to tell you that there's another way. That you can do all that by yourself.
    </p>
    <p>
        I know you all probably think of me as a hero, and I accept this responsibility.
    </p>
    <p class="centered-text big bold italic">
        In your nightmares you send commands to your VkCommandBuffer, and it brings joy to your heart.
    </p>
    <p>
        So bring up your terminal, open your favorite text editor, and let's make our own simulator.
        You may use an <a href="https://www.learncpp.com/cpp-tutorial/installing-an-integrated-development-environment-ide/" target="_blank">IDE</a> if you wish.
        I am not here to teach you all the technicalities involved
        in compiling and linking the source code, you will have to learn that <a href="https://www.learncpp.com/cpp-tutorial/compiling-your-first-program/" target="_blank">somewhere else</a>.
        Nor will I teach you how to program in <a href="https://a.co/d/8qRAAeX" target="_blank">C</a>.
        But I <em>will</em> teach you the computer science behind generating images like that of the teapot above.
    </p>
    </article>

    <!-- FIRST PRINCIPLES -->
    <h2 id="first-principles" class="chapter merriweather-black">First Principles</h2>
    <article class="merriweather-regular">
    <p>
        What is the first step in creating our own <a href="https://en.wikipedia.org/wiki/The_Matrix" target="_blank">matrix</a>?
        We don't want to build a general-purpose simulation, we want to experience it, too.
        That means we need some sort of a portal into another dimension -
        a <a href="https://narnia.fandom.com/wiki/Wardrobe" target="_blank">wardrobe</a> that opens to Narnia.
        There are different ways of accomplishing this. One of them is by creating an image, and then displaying it on an image viewer.
        But there are <a href="https://en.wikipedia.org/wiki/Image_file_format#Major_graphic_file_formats" target="_blank">so many</a> image formats, which one to choose?
    </p>
    <p>
        One of the simplest image formats is <a href="https://en.wikipedia.org/wiki/Netpbm" target="_blank">PPM</a>.
        Here's an example from wikipedia:
        <table>
            <tr>
                <td>P3</td>
            </tr>
            <tr>
                <td>3</td>
                <td>2</td>
            </tr>
            <tr>
                <td>255</td>
            </tr>
            <tr>
                <td>255</td>
                <td>0</td>
                <td>0</td>
            </tr>
            <tr>
                <td>0</td>
                <td>255</td>
                <td>0</td>
            </tr>
            <tr>
                <td>0</td>
                <td>0</td>
                <td>255</td>
            </tr>
            <tr>
                <td>255</td>
                <td>255</td>
                <td>0</td>
            </tr>
            <tr>
                <td>255</td>
                <td>255</td>
                <td>255</td>
            </tr>
            <tr>
                <td>0</td>
                <td>0</td>
                <td>0</td>
            </tr>
        </table>
    </p>
    <p>
        <strong>P3</strong> denotes that this is an <a href="https://en.wikipedia.org/wiki/ASCII" target="_blank">ASCII</a> file.
        <strong>3</strong> and <strong>2</strong> are the width and the height of the image, respectively.
        <strong>255</strong> on the next line means <em>"end of header"</em>. That is, everything that comes after this line are the actual colors of the image,
        which we discuss next.
    </p>
    <p>
        What <i>is</i> <strong>color</strong>? This may shock you when I say this, but, colors aren't real. They don't actually exist.
        Colors are no more real than the Santa Claus who gifts you presents (or coal!) every Christmas.
        We all partake in a great conspiracy when we open our eyes and see. Colors form an important part of our shared hallucination of the world,
        apart from money and religion. It's funny when you think about it: the teapot that you saw earlier is a lie that approximates another lie
        concocted by the buzzing of neurons inside your <a href="https://en.wikipedia.org/wiki/Visual_cortex" target="_blank">visual cortex</a>.
    </p>
    <p>
        In the real world we have something called the <a href="https://en.wikipedia.org/wiki/Electromagnetic_spectrum" target="_blank">electromagnetic spectrum</a>,
        only a small part of which makes up the wavelengths that the human eye can see:
    </p>
    <p>
        <img alt="Electromagnetic spectrum" src="../svgs/spectrum.svg">
    </p>
    <p>
        Worse, the cells within your eye have different sensitivities to different parts of the visible spectrum.
        The image below which I yoinked from <a href="https://www.simplypsychology.org/what-is-the-trichromatic-theory-of-color-vision.html" target="_blank">simplepsychology.org</a>,
        illustrates this nicely: 
    </p>
    <p>
        <img alt="Human color sensitivities" src="../webp/eye-color-sensitivity.webp">
    </p>
    <p>
        Yeah I inverted the colors so that it doesn't burn your eyes. Here's the <a href="https://www.simplypsychology.org/wp-content/uploads/eye-color-sensitivity.png" target="_blank">real image</a>.
        The point is that you may see some colors <em>"brighter"</em> than others.
        Also due to awkward wiring you have a blind spot:
    </p>
    <p>
        <img alt="Human eye blind spot" src="../jpg/blind-spot.jpg">
    </p>
    <p>
        <i>"But... I don't see any dark patches in my vision?!"</i>, you might say.
        Well, thanks to this oopsie-poopsie made by the clunky hand of evolution,
        your brain now has to compensate for this by literally <a href="https://en.wikipedia.org/wiki/Blind_spot_(vision)" target="_blank">filling in</a> the void.
        Life decided that it would rather hallucinate than to actually see, i.e., you have always lived in your own <a href="https://en.wikipedia.org/wiki/Metaverse" target="_blank">Metaverse</a>,
        and you have never really touched grass.
        By the way, cephalopods <a href="https://youtu.be/HATW8xJMxAc?si=E_YykDNmXw-hIPkN" target="_blank">don't have this problem</a>.
    </p>
    <p>
        What I want you to get from all this is that everything is fake: you are fake, I am fake, your Mom is fake, etc.
        That being said, the chicanery of light and color is often too complex for computers to handle
        (especially when we want to generate our images fast).
        Instead what we do is take the visible part of the electromagnetic spectrum and quantize it with reference to the intensity of three colors:
        <span style="color: red;">RED</span>, <span style="color: green;">GREEN</span>, and <span style="color: blue;">BLUE</span>.
        We represent these intensities as an integer between 0 and 255.
        This gives us a total of 256 * 256 * 256 = 16777216 (~16 million) colors to work with.
        Take a look at that PPM image again. The first row is:
    </p>
    <p>
        <table>
            <tr>
                <td>255</td>
                <td>0</td>
                <td>0</td>
            </tr>
        </table>
    </p>
    <p>
        This array of numbers represents the <span style="color: red;">RED</span> color.
        The next row is:
    </p>
    <p>
        <table>
            <tr>
                <td>0</td>
                <td>255</td>
                <td>0</td>
            </tr>
        </table>
    </p>
    <p>
        This is the <span style="color: green;">GREEN</span> color.
        When we <em>interpret</em> the color information together with the width and the height values, we get the following image:
    </p>
    <p>
        <img alt="PPM image example" src="../svgs/ppm.svg">
    </p>
    <p>
        We now know that to generate images we will need a structure that stores width, height, and an array of numbers that represents the colors.
        So, let us do that:
    </p>
    <p>
        <pre><code id="code-0" class="source-code-pro-regular">
        </code></pre>
    </p>
    <p>
        This creates the following image:
    </p>
    <p>
        <img alt="Output of the code" src="../svgs/cursedgl_0.svg">
    </p>
    </article>
    <script>
    const escapeHtml = (unsafe) => {
        return unsafe.replaceAll('&', '&amp;').replaceAll('<', '&lt;').replaceAll('>', '&gt;').replaceAll('"', '&quot;').replaceAll("'", '&#039;');
    };

    const CODE_0 = `#include <stdio.h>
#include <stdint.h>

struct ColorBuffer
{
    uint32_t width;
    uint32_t height;
    uint32_t* pixels;
};

int main()
{


    return 0;
}
`;

    document.querySelector("#code-0").innerHTML = escapeHtml(CODE_0);
    </script>
</body>
</html>